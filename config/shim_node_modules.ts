import { resolve } from 'path';
import { readFile, writeFile } from 'fs/promises';

shimEslint()
	.then();

async function shimEslint(): Promise<void> {
	const loadRulesPath = resolve(process.cwd(), 'node_modules/eslint/lib/cli-engine/load-rules.js');

	const content = await readFile(loadRulesPath, 'utf-8');
	const newContent = content
		.replace(/if \(path\.extname\(file\) !== "\.js"\)/g, 'if (path.extname(file) !== ".js" && path.extname(file) !== \'.cjs\')')
		.replace(/rules\[file\.slice\(0, -3\)]/g, 'rules[file.slice(0, -path.extname(file).length)]')

	await writeFile(loadRulesPath, newContent, 'utf-8');
}
